%%
clear;clc;close all;
mask_thre = 240;
pathA = '/home/Cuiyirui/GAN/dataset/picture_1000_stripe_3/train_instense_1K/';
pathB = '/home/Cuiyirui/GAN/dataset/picture_1000_stripe_3/train_normed_1K/';
img_path_list=dir(strcat(pathA,'*.png'));
new_im = zeros(256,768,3);
new_im = uint8(new_im);



%% Extract Mask
% for i =1:length(img_path_list)
%     im_name = strcat(pathA,num2str(i),'.png');
%     im = imread(im_name);
%     % extract contour
%     contour = im(:,1:256,:);
%     contour = rgb2gray(contour);
%     % extract mask
%     
%     mask = extractMask(contour,mask_thre);
%     mask = mask*255;
%     mask = cat(3,mask,mask,mask);
%     % creat new image
%     new_im(:,1:512,:)=im;
%     new_im(:,513:768,:)=mask;
%     new_name = strcat(pathB,num2str(i),'.png');
%     imwrite(new_im,new_name);
% end
    
   
 %% Extract stripe fashion
%  for i = 1:12
%      stripe_im_name = strcat(pathA,num2str(i),'.png');
%      fashion_im_name = strcat(pathB,num2str(i*3),'.png');
%      stripe_im = imread(stripe_im_name);
%      fashion_im = imread(fashion_im_name);
%      stripe_im(:,1:256,:)=fashion_im(:,1:256,:);
%      new_name=strcat(pathA,num2str(i+20),'.png');
%      imwrite(stripe_im,new_name);
%  end


%% rename
% for i = 1:length(img_path_list)
%     im_name = strcat(pathA,img_path_list(i).name);
%     image = imread(im_name);
%     new_name = strcat(pathB,num2str(i),'.jpg');
%     imwrite(image,new_name)
% end


%% 3 to 2
% for i=1:length(img_path_list)
%     im_name = strcat(pathA,num2str(i),'.jpg');
%     im = imread(im_name);
%     newim = im(:,1:512,:);
%     new_name=strcat(pathB,num2str(i),'.jpg');
%     imwrite(newim,new_name);
%     
% end


%% extract mask and expand dataset
% for i=0:985
%     if(i<10)
%         prefix = 'input_image00';
%     elseif(i>=10 && i<100)
%         prefix = 'input_image0';
%     else
%         prefix = 'input_image';
%     end
%     % define name
%     ground_truth_name = strcat(pathA,prefix,num2str(i),'_encoded.jpg');
%     contour_name = strcat(pathA,prefix,num2str(i),'_ground_truth.jpg');
%     % load data
%     ground_truth = imread(ground_truth_name);
%     contour = imread(contour_name);
%     gray_contour = rgb2gray(contour);
%     % extract mask
%     mask = extractMask(gray_contour,mask_thre);
%     mask = mask*255;
%     mask = cat(3,mask,mask,mask);
%     % creat new image
%     new_im(:,1:256,:)=contour;
%     new_im(:,257:512,:)=ground_truth;
%     new_im(:,513:768,:)=mask;
%     new_name = strcat(pathB,num2str(i),'.png');
%     imwrite(new_im,new_name);
%     % imwrite sample
%     for j = 1:10
%         if(j<10)
%             suffix='_random_sample0';
%         else
%             suffix='_random_sample';
%         end
%         random_sample_name=strcat(pathA,prefix,num2str(i),suffix,num2str(j),'.jpg');
%         random_sample=imread(random_sample_name);
%         new_im(:,1:256,:)=contour;
%         new_im(:,257:512,:)=random_sample;
%         new_im(:,513:768,:)=mask;
%         new_name = strcat(pathB,num2str(i),'_',num2str(j),'.png');
%         imwrite(new_im,new_name);
%     end
%     
% end
 %% bold contour
%  for i =53:64
%      %im_name = strcat(pathA,img_path_list(i).name);
%      im_name =strcat(pathA,num2str(i),'.jpg');
%      im = imread(im_name);
%      % extract contour
%      contour = im(:,1:256,:);
%      contour = rgb2gray(contour);
%      for j=1:256
%          for k=1:256
%              if (contour(j,k)<100)
%                  contour(j,k)=0;
%              end
%          end
%      end
%       contour = cat(3,contour,contour,contour);
%       im(:,1:256,:)=contour;
%       %new_name=strcat(pathB,img_path_list(i).name);
%        new_name =strcat(pathB,num2str(i),'.png');
%       imwrite(im,new_name);
%       
%  end
%% thining line
for i=1:length(img_path_list)
    im_name=strcat(pathA,num2str(i),'.png');
    im = imread(im_name);
    contour = im(:,1:256,:);
    contour = im2bw(contour);
    %extract contour 
    
    %
    bw2 = ~bwmorph(~contour,'thin');
    bw2 = uint8(bw2)*255;
    contour = cat(3,bw2,bw2,bw2);
    im(:,1:256,:)=contour;
    new_name = strcat(pathB,num2str(i),'.png');
    imwrite(im,new_name);
    
    
end